{{ define "main" }}
{{ $visibleGames := site.Data.games }}
{{ if not hugo.IsServer }}
  {{ $visibleGames = where $visibleGames "hidden" "ne" true }}
{{ end }}
{{ $seriesName := .Params.series }}
{{ $slug := .Params.slug }}

<h1 class="page-title">{{ $seriesName | title }}</h1>

{{ $games := where $visibleGames "series" $seriesName }}
{{ $games = sort $games "title" "asc" }}

<div class="game-controls" data-game-grid>
  <div class="controls">
    <div class="control">
      <label>Sort</label>
      <select data-sort>
        <option value="az">Title (A to Z)</option>
        <option value="za">Title (Z to A)</option>
      </select>
    </div>
    <div class="control">
      <label>Genre</label>
      <select data-genre>
        <option value="All">All</option>
      </select>
    </div>
  </div>

  <div class="game-grid">
    {{ range $games }}
      {{ partial "game-card.html" (dict "game" . "ctx" $) }}
    {{ end }}
  </div>
</div>
{{ end }}

{{ define "preloads" }}
  {{ $visibleGames := site.Data.games }}
{{ if not hugo.IsServer }}
  {{ $visibleGames = where $visibleGames "hidden" "ne" true }}
{{ end }}
  {{ $seriesName := .Params.series }}
  {{ $games := where $visibleGames "series" $seriesName }}
  {{ $games = sort $games "title" "asc" }}
  {{ range first 6 $games }}
    {{ $img := partial "resolve-game-image.html" . }}
    {{ if ne $img "/Images/placeholder.jpg" }}
      <link rel="preload" as="image" href="{{ $img | relURL }}" fetchpriority="high" />
    {{ end }}
  {{ end }}
{{ end }}
