{{- $base := .Site.BaseURL -}}
{{- $games := site.Data.games -}}
{{- $recent := where $games "date_added" "ne" "" -}}
{{- $recent = sort $recent "date_added" "desc" -}}

{{- printf "<?xml version=\"1.0\" encoding=\"utf-8\"?>" | safeHTML -}}
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:media="http://search.yahoo.com/mrss/">
  <channel>
    <title>{{ .Site.Title }} â€“ Recent Additions</title>
    <link>{{ $base }}</link>
    <atom:link href="{{ "rss.xml" | absURL }}" rel="self" type="application/rss+xml" />
    <description>The 50 most recent additions to The Gaming Emporium. (Links go to the site first.)</description>
    <lastBuildDate>{{ now.UTC.Format "Mon, 02 Jan 2006 15:04:05 -0700" }}</lastBuildDate>

    {{- range first 50 $recent }}
      {{- $title := .title -}}
      {{- $slug := $title | lower | urlize -}}
      {{- $img := (printf "/Images/Games/%s.webp" $slug) | absURL -}}
      {{- $internal := (printf "/game/%s/" $slug) | absURL -}}
      {{- $external := .link -}}
      <item>
        <title>{{ $title | htmlEscape }}</title>
        <link>{{ $internal | htmlEscape }}</link>
        <guid isPermaLink="false">{{ $slug }}-{{ .date_added | htmlEscape }}</guid>
        <pubDate>{{ (time .date_added).UTC.Format "Mon, 02 Jan 2006 15:04:05 -0700" }}</pubDate>

        <!-- Images (thumbnail + enclosure) -->
        <media:thumbnail url="{{ $img | htmlEscape }}" />
        <media:content url="{{ $img | htmlEscape }}" medium="image" />
        <enclosure url="{{ $img | htmlEscape }}" type="image/webp" />

        <!-- Plain-text description (avoid CDATA/XML parse issues) -->
        <description>{{ printf "Category: %s | External link: %s" .category $external | htmlEscape }}</description>
      </item>
    {{- end }}
  </channel>
</rss>
