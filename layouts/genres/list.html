{{ define "preloads" }}
  {{/* No image preloads needed for text-only genre cards */}}
{{ end }}

{{ define "main" }}
{{ $visibleGames := site.Data.games }}
{{ if not hugo.IsServer }}
  {{ $visibleGames = where $visibleGames "hidden" "ne" true }}
{{ end }}
<h1 class="page-title">Browse By Genre</h1>

{{/* Build a unique list of genres from genre1 + genre2 */}}
{{ $allGenres := slice }}
{{ range $visibleGames }}
  {{ with .genre1 }}{{ if ne . "" }}{{ $allGenres = $allGenres | append . }}{{ end }}{{ end }}
  {{ with .genre2 }}{{ if ne . "" }}{{ $allGenres = $allGenres | append . }}{{ end }}{{ end }}
{{ end }}
{{ $allGenres = sort (uniq $allGenres) }}

<div class="genre-controls" data-genre-grid>
  <div class="genre-grid">
    {{ range $allGenres }}
      {{ $g := . }}
      {{ $slug := urlize $g }}
      {{ $disp := partial "format-genre.html" $g }}
      <a class="genre-card genre-{{ $slug }}" data-title="{{ $disp }}" href="{{ (printf "/genres/%s/" $slug) | relURL }}">
        <span class="genre-title">{{ $disp }}</span>
      </a>
    {{ end }}
  </div>
</div>
{{ end }}
