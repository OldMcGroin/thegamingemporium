{{ define "main" }}
{{ $visibleGames := site.Data.games }}
{{ if not hugo.IsServer }}
  {{ $visibleGames = where $visibleGames "hidden" "ne" true }}
{{ end }}
<h1 class="page-title">All</h1>


{{ $games := where $visibleGames "category" "ne" "guides" }}

<div class="game-controls" data-game-grid>
  <div class="controls">
    <div class="control">
      <label>Sort</label>
      
    
      <select data-sort>
        <option value="az">Title (A to Z)</option>
        <option value="za">Title (Z to A)</option>
      </select>
</div>
    <div class="control">
  <label>Genre</label>
  <div class="genre-dropdown" data-genre-dropdown>
    <button type="button" class="genre-dropdown-toggle" data-genre-dropdown-toggle aria-expanded="false">
      Genre â–¾
    </button>
    <div class="genre-dropdown-panel" data-genre-dropdown-panel hidden>
      <div class="genre-chips" data-genre-chips aria-label="Genre filters"></div>
    </div>
  </div>
</div>
  </div>

  <div class="game-grid">
    {{ range $games }}
      {{ partial "game-card.html" (dict "game" . "ctx" $) }}
    {{ end }}
  </div>
</div>
{{ end }}

{{/* Preload first few visible game images to make the initial grid feel instant */}}
{{ define "preloads" }}
  {{ $visibleGames := site.Data.games }}
{{ if not hugo.IsServer }}
  {{ $visibleGames = where $visibleGames "hidden" "ne" true }}
{{ end }}
  {{ $games := where $visibleGames "category" "ne" "guides" }}
  {{ range first 6 $games }}
    {{ $img := partial "resolve-game-image.html" . }}
    {{ if ne $img "/Images/placeholder.jpg" }}
      <link rel="preload" as="image" href="{{ $img | relURL }}" fetchpriority="high" />
    {{ end }}
  {{ end }}
{{ end }}
