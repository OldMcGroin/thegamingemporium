(function(){function n(e){return Array.from(new Set(e)).sort(function(e,t){return e.localeCompare(t)})}function s(){if(r=document.querySelector("[data-carousel]"),!r)return;if(e=r.querySelector(".carousel__track"),n=r.querySelector(".carousel__slides"),!e||!n)return;o=Array.from(n.querySelectorAll(".carousel__slide")),t=0;function s(s){t=(s+o.length)%o.length;var a,r,c=o[0]?o[0].getBoundingClientRect().width:e.getBoundingClientRect().width,i=0;try{a=window.getComputedStyle(n),i=parseFloat(a.columnGap||a.gap||"0")||0}catch{i=0}r=c+i,n.style.transform="translateX("+-t*r+"px)",o.forEach(function(e,n){e.setAttribute("aria-hidden",n===t?"false":"true")})}d=r.querySelector("[data-carousel-prev]"),u=r.querySelector("[data-carousel-next]"),d&&d.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),s(t-1)}),u&&u.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),s(t+1)}),window.addEventListener("resize",function(){s(t)}),document.addEventListener("keydown",function(e){e.key==="ArrowLeft"&&s(t-1),e.key==="ArrowRight"&&s(t+1)});var e,t,n,o,r,d,u,c=0,h=0,a=!1,l=!1,i=null;function m(e,t,s){c=e,h=t,a=!0,l=!1,i=s||null,n.classList.add("is-dragging")}function f(s,i){if(!a)return;var r,u,f,p,d=s-c,m=i-h;if(!l){if(Math.abs(m)>Math.abs(d)&&Math.abs(m)>8){a=!1,n.classList.remove("is-dragging");return}Math.abs(d)>6&&(l=!0)}if(!l)return;f=o[0]?o[0].getBoundingClientRect().width:e.getBoundingClientRect().width||1,r=0;try{u=window.getComputedStyle(n),r=parseFloat(u.columnGap||u.gap||"0")||0}catch{r=0}p=f+r,n.style.transform="translateX("+(-t*p+d)+"px)"}function p(o){if(!a)return;var r=o-c,l=e.getBoundingClientRect().width||1;n.classList.remove("is-dragging"),a=!1,(r<0?-r:r)>Math.max(40,l*.12)?s(r<0?t+1:t-1):s(t)}window.PointerEvent?(e.addEventListener("pointerdown",function(t){if(t.pointerType==="mouse")return;e.setPointerCapture&&e.setPointerCapture(t.pointerId),m(t.clientX,t.clientY,t.pointerId)},{passive:!0}),e.addEventListener("pointermove",function(e){if(i!==null&&e.pointerId!==i)return;f(e.clientX,e.clientY)},{passive:!0}),e.addEventListener("pointerup",function(e){if(i!==null&&e.pointerId!==i)return;p(e.clientX,e.clientY),i=null},{passive:!0}),e.addEventListener("pointercancel",function(){n.classList.remove("is-dragging"),a=!1,i=null,s(t)},{passive:!0})):(e.addEventListener("touchstart",function(e){if(!e.touches||!e.touches.length)return;var t=e.touches[0];m(t.clientX,t.clientY)},{passive:!0}),e.addEventListener("touchmove",function(e){if(!e.touches||!e.touches.length)return;var t=e.touches[0];f(t.clientX,t.clientY)},{passive:!0}),e.addEventListener("touchend",function(e){var t=e.changedTouches&&e.changedTouches[0]?e.changedTouches[0]:null;p(t?t.clientX:c,t?t.clientY:h)},{passive:!0})),s(0)}function e(e){var n=e&&e.getAttribute?e.getAttribute("data-weight"):null,t=parseFloat(n);return isNaN(t)?0:t}function o(){document.querySelectorAll("[data-game-grid]").forEach(function(t){var s,o,i,a,r,c=t.querySelector(".game-grid");if(!c)return;a=Array.from(c.querySelectorAll(".game-card")),s=t.querySelector("select[data-genre], select[data-genre-filter]"),i=t.querySelector("select[data-sort]"),s&&(o=[],a.forEach(function(e){var t=(e.getAttribute("data-genres")||"").split("|").map(function(e){return e.trim()}).filter(Boolean);o=o.concat(t)}),o=n(o),s.innerHTML="",r=document.createElement("option"),r.value="",r.textContent="All",s.appendChild(r),o.forEach(function(e){var t=document.createElement("option");t.value=e,t.textContent=e,s.appendChild(t)}));function l(){var e=s?s.value:"";a.forEach(function(t){var n=t.getAttribute("data-genres")||"",s=!e||n.split("|").map(function(e){return e.trim()}).indexOf(e)!==-1;t.style.display=s?"":"none"})}function d(){if(!i)return;var n=i.value||"az",t=a.slice();t.sort(function(t,s){var o,r,c,i=e(t),a=e(s);return i!==a?i-a:(r=(t.getAttribute("data-title")||"").toLowerCase(),c=(s.getAttribute("data-title")||"").toLowerCase(),o=r.localeCompare(c),n==="za"?-o:o)}),t.forEach(function(e){c.appendChild(e)})}s&&s.addEventListener("change",function(){l()}),i&&i.addEventListener("change",function(){d()}),l(),d()})}function i(){document.querySelectorAll("[data-series-grid]").forEach(function(e){var t,s,n=e.querySelector(".series-grid");if(!n)return;if(s=Array.from(n.querySelectorAll(".series-card")),t=e.querySelector("select[data-sort]"),!t)return;function o(){var e=t.value||"az",o=s.slice().sort(function(t,n){var o=(t.getAttribute("data-title")||"").toLowerCase(),i=(n.getAttribute("data-title")||"").toLowerCase(),s=o.localeCompare(i);return e==="za"?-s:s});o.forEach(function(e){n.appendChild(e)})}t.addEventListener("change",o),o()})}function a(){document.querySelectorAll("[data-genre-grid]").forEach(function(e){var t,s,n=e.querySelector(".genre-grid");if(!n)return;if(s=Array.from(n.querySelectorAll(".genre-card")),t=e.querySelector("select[data-sort]"),!t)return;function o(){var e=t.value||"az",o=s.slice().sort(function(t,n){var o=(t.getAttribute("data-title")||"").toLowerCase(),i=(n.getAttribute("data-title")||"").toLowerCase(),s=o.localeCompare(i);return e==="za"?-s:s});o.forEach(function(e){n.appendChild(e)})}t.addEventListener("change",o),o()})}function t(e){try{return String(e||"").normalize("NFKD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}catch{return String(e||"").toLowerCase().trim().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}}function r(){var e=Object.create(null);document.addEventListener("click",function(n){var s,i,a,r,o=n.target&&n.target.closest?n.target.closest("a.game-card__link"):null;if(!o)return;if(s=(o.getAttribute("data-game-id")||"").trim(),s||(i=o.querySelector(".game-card__title"),i&&(s=t(i.textContent))),!s)return;if(a=Date.now(),e[s]&&a-e[s]<3500)return;e[s]=a,r="/api/click?id="+encodeURIComponent(s);try{navigator.sendBeacon?navigator.sendBeacon(r):fetch(r,{method:"GET",keepalive:!0}).catch(function(){})}catch{}},{passive:!0})}function c(){var e,s,c,l,d,u,r=document.getElementById("popularBtn"),m=document.getElementById("popularClose"),n=document.getElementById("popularPopover"),o=document.getElementById("popularList"),h=document.getElementById("popularMsg");if(!r||!n||!o)return;d=Object.create(null);try{for(s=window.__GAME_INDEX__||[],e=0;e<s.length;e++){if(c=s[e]&&s[e].title,u=s[e]&&s[e].url,!c||!u)continue;d[t(c)]={title:c,url:u}}}catch{}function i(e){h&&(h.textContent=e)}l=!1;function f(){if(l)return;l=!0,i("Loading…"),fetch("/api/top?limit=10",{cache:"no-store"}).then(function(e){return e.json()}).then(function(e){if(!e||!e.ok||!Array.isArray(e.top))throw new Error("bad");if(o.innerHTML="",e.top.length===0){if(o.innerHTML='<li class="popular__empty">No clicks recorded yet.</li>',u===0){o.innerHTML='<li class="popular__empty">No popular games yet — start clicking game cards and they will appear here.</li>',i("");return}i("");return}for(var t,n,s,a,c,l,u=0,r=0;r<e.top.length;r++){if(c=e.top[r]||{},t=String(c.id||"").trim(),!t)continue;if(t==="test-game"||t==="test-live"||t.indexOf("test-")===0)continue;l=d[t]||{title:t,url:"#"},n=document.createElement("li"),n.className="popular__item",s=document.createElement("a"),s.className="popular__link",s.textContent=l.title,s.href=l.url,a=document.createElement("span"),a.className="popular__count",a.textContent="("+(c.count||0)+")",n.appendChild(s),n.appendChild(a),o.appendChild(n),u++}i("")}).catch(function(){i("Couldn't load popular games right now.")})}function p(){n.hidden=!1,r.setAttribute("aria-expanded","true"),f()}function a(){n.hidden=!0,r.setAttribute("aria-expanded","false")}function g(){n.hidden?p():a()}r.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),g()}),m&&m.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),a()}),document.addEventListener("click",function(e){if(n.hidden)return;var t=e.target;if(!t)return;if(t.closest&&(t.closest("#popularPopover")||t.closest("#popularBtn")))return;a()}),document.addEventListener("keydown",function(e){e.key==="Escape"&&!n.hidden&&a()})}document.addEventListener("DOMContentLoaded",function(){s(),o(),i(),a(),r(),c()})})()