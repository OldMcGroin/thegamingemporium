(function(){function n(e){return Array.from(new Set(e)).sort(function(e,t){return e.localeCompare(t)})}function s(){if(r=document.querySelector("[data-carousel]"),!r)return;if(e=r.querySelector(".carousel__track"),n=r.querySelector(".carousel__slides"),!e||!n)return;o=Array.from(n.querySelectorAll(".carousel__slide")),t=0;function s(s){t=(s+o.length)%o.length;var a,r,c=o[0]?o[0].getBoundingClientRect().width:e.getBoundingClientRect().width,i=0;try{a=window.getComputedStyle(n),i=parseFloat(a.columnGap||a.gap||"0")||0}catch{i=0}r=c+i,n.style.transform="translateX("+-t*r+"px)",o.forEach(function(e,n){e.setAttribute("aria-hidden",n===t?"false":"true")})}d=r.querySelector("[data-carousel-prev]"),u=r.querySelector("[data-carousel-next]"),d&&d.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),s(t-1)}),u&&u.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),s(t+1)}),window.addEventListener("resize",function(){s(t)}),document.addEventListener("keydown",function(e){e.key==="ArrowLeft"&&s(t-1),e.key==="ArrowRight"&&s(t+1)});var e,t,n,o,r,d,u,c=0,h=0,a=!1,l=!1,i=null;function m(e,t,s){c=e,h=t,a=!0,l=!1,i=s||null,n.classList.add("is-dragging")}function f(s,i){if(!a)return;var r,u,f,p,d=s-c,m=i-h;if(!l){if(Math.abs(m)>Math.abs(d)&&Math.abs(m)>8){a=!1,n.classList.remove("is-dragging");return}Math.abs(d)>6&&(l=!0)}if(!l)return;f=o[0]?o[0].getBoundingClientRect().width:e.getBoundingClientRect().width||1,r=0;try{u=window.getComputedStyle(n),r=parseFloat(u.columnGap||u.gap||"0")||0}catch{r=0}p=f+r,n.style.transform="translateX("+(-t*p+d)+"px)"}function p(o){if(!a)return;var r=o-c,l=e.getBoundingClientRect().width||1;n.classList.remove("is-dragging"),a=!1,(r<0?-r:r)>Math.max(40,l*.12)?s(r<0?t+1:t-1):s(t)}window.PointerEvent?(e.addEventListener("pointerdown",function(t){if(t.pointerType==="mouse")return;e.setPointerCapture&&e.setPointerCapture(t.pointerId),m(t.clientX,t.clientY,t.pointerId)},{passive:!0}),e.addEventListener("pointermove",function(e){if(i!==null&&e.pointerId!==i)return;f(e.clientX,e.clientY)},{passive:!0}),e.addEventListener("pointerup",function(e){if(i!==null&&e.pointerId!==i)return;p(e.clientX,e.clientY),i=null},{passive:!0}),e.addEventListener("pointercancel",function(){n.classList.remove("is-dragging"),a=!1,i=null,s(t)},{passive:!0})):(e.addEventListener("touchstart",function(e){if(!e.touches||!e.touches.length)return;var t=e.touches[0];m(t.clientX,t.clientY)},{passive:!0}),e.addEventListener("touchmove",function(e){if(!e.touches||!e.touches.length)return;var t=e.touches[0];f(t.clientX,t.clientY)},{passive:!0}),e.addEventListener("touchend",function(e){var t=e.changedTouches&&e.changedTouches[0]?e.changedTouches[0]:null;p(t?t.clientX:c,t?t.clientY:h)},{passive:!0})),s(0)}function t(e){var n=e&&e.getAttribute?e.getAttribute("data-weight"):null,t=parseFloat(n);return isNaN(t)?0:t}function o(){document.querySelectorAll("[data-game-grid]").forEach(function(e){var s,o,i,a,r,c=e.querySelector(".game-grid");if(!c)return;a=Array.from(c.querySelectorAll(".game-card")),s=e.querySelector("select[data-genre], select[data-genre-filter]"),i=e.querySelector("select[data-sort]"),s&&(o=[],a.forEach(function(e){var t=(e.getAttribute("data-genres")||"").split("|").map(function(e){return e.trim()}).filter(Boolean);o=o.concat(t)}),o=n(o),s.innerHTML="",r=document.createElement("option"),r.value="",r.textContent="All",s.appendChild(r),o.forEach(function(e){var t=document.createElement("option");t.value=e,t.textContent=e,s.appendChild(t)}));function l(){var e=s?s.value:"";a.forEach(function(t){var n=t.getAttribute("data-genres")||"",s=!e||n.split("|").map(function(e){return e.trim()}).indexOf(e)!==-1;t.style.display=s?"":"none"})}function d(){if(!i)return;var n=i.value||"az",e=a.slice();e.sort(function(e,s){var o,r,c,i=t(e),a=t(s);return i!==a?i-a:(r=(e.getAttribute("data-title")||"").toLowerCase(),c=(s.getAttribute("data-title")||"").toLowerCase(),o=r.localeCompare(c),n==="za"?-o:o)}),e.forEach(function(e){c.appendChild(e)})}s&&s.addEventListener("change",function(){l()}),i&&i.addEventListener("change",function(){d()}),l(),d()})}function i(){document.querySelectorAll("[data-series-grid]").forEach(function(e){var t,s,n=e.querySelector(".series-grid");if(!n)return;if(s=Array.from(n.querySelectorAll(".series-card")),t=e.querySelector("select[data-sort]"),!t)return;function o(){var e=t.value||"az",o=s.slice().sort(function(t,n){var o=(t.getAttribute("data-title")||"").toLowerCase(),i=(n.getAttribute("data-title")||"").toLowerCase(),s=o.localeCompare(i);return e==="za"?-s:s});o.forEach(function(e){n.appendChild(e)})}t.addEventListener("change",o),o()})}function a(){document.querySelectorAll("[data-genre-grid]").forEach(function(e){var t,s,n=e.querySelector(".genre-grid");if(!n)return;if(s=Array.from(n.querySelectorAll(".genre-card")),t=e.querySelector("select[data-sort]"),!t)return;function o(){var e=t.value||"az",o=s.slice().sort(function(t,n){var o=(t.getAttribute("data-title")||"").toLowerCase(),i=(n.getAttribute("data-title")||"").toLowerCase(),s=o.localeCompare(i);return e==="za"?-s:s});o.forEach(function(e){n.appendChild(e)})}t.addEventListener("change",o),o()})}function e(e){try{return String(e||"").normalize("NFKD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}catch{return String(e||"").toLowerCase().trim().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}}function r(){var n,s,o,a,r,c,i=Object.create(null),l="tge_seen_game_impressions_v1",t=Object.create(null);try{if(a=sessionStorage.getItem(l),a&&(n=JSON.parse(a),Array.isArray(n)))for(s=0;s<n.length;s++)t[n[s]]=!0}catch{}function d(){try{var n=Object.keys(t);n.length>600&&(n=n.slice(n.length-600)),sessionStorage.setItem(l,JSON.stringify(n))}catch{}}try{if("IntersectionObserver"in window)for(r=new IntersectionObserver(function(n){for(var s,o,i,a,l,u,c=0;c<n.length;c++){if(o=n[c],!o.isIntersecting||o.intersectionRatio<.6)continue;if(i=o.target,r.unobserve(i),a=i.querySelector&&i.querySelector("a.game-card__link"),!a)continue;if(s=(a.getAttribute("data-game-id")||"").trim(),s||(l=a.querySelector(".game-card__title"),l&&(s=e(l.textContent))),!s||t[s])continue;t[s]=!0,d(s),u="/api/view?id="+encodeURIComponent(s);try{navigator.sendBeacon?navigator.sendBeacon(u):fetch(u,{method:"GET",keepalive:!0}).catch(function(){})}catch{}}},{threshold:[.6]}),c=document.querySelectorAll(".game-card"),o=0;o<c.length;o++)r.observe(c[o])}catch{}document.addEventListener("click",function(t){var n,o,a,r,s=t.target&&t.target.closest?t.target.closest("a.game-card__link"):null;if(!s)return;if(n=(s.getAttribute("data-game-id")||"").trim(),n||(o=s.querySelector(".game-card__title"),o&&(n=e(o.textContent))),!n)return;if(a=Date.now(),i[n]&&a-i[n]<3500)return;i[n]=a,r="/api/click?id="+encodeURIComponent(n);try{navigator.sendBeacon?navigator.sendBeacon(r):fetch(r,{method:"GET",keepalive:!0}).catch(function(){})}catch{}},{passive:!0})}function c(){var n,s,o,i,l,d,u,m,p,g,b,a=Array.prototype.slice.call(document.querySelectorAll("[data-popular-toggle]")),x=document.getElementById("popularClose"),t=document.getElementById("popularPopover"),c=document.getElementById("popularList"),O=document.getElementById("popularMsg"),r=document.getElementById("popularUpdated"),v=Array.prototype.slice.call(document.querySelectorAll("[data-popular-mode]"));if(!a.length||!t||!c)return;p=Object.create(null),g=Object.create(null);try{for(i=window.__GAME_INDEX__||[],o=0;o<i.length;o++){if(l=i[o]&&i[o].title,m=i[o]&&i[o].url,!l||!m)continue;b=e(l),p[b]={title:l,url:m},g[b.replace(/-/g,"")]={title:l,url:m}}}catch{}function h(e){O&&(O.textContent=e)}function C(e){var t=String(e||"").split("-").filter(Boolean);return t.map(function(e){return e==="x"?"X":e==="ps"||e==="psx"||e==="ps2"||e==="ps3"||e==="ps4"||e==="ps5"?e.toUpperCase():e==="wii"?"Wii":e==="gba"?"GBA":e==="gb"?"GB":e==="c64"?"C64":e==="n64"?"N64":e.charAt(0).toUpperCase()+e.slice(1)}).join(" ")}function y(e){if(!e||!e.getBoundingClientRect)return;var s=e.getBoundingClientRect(),o=s.bottom+10,n=Math.max(10,s.right-t.offsetWidth),i=Math.max(10,window.innerWidth-t.offsetWidth-10),n=Math.min(n,i);t.style.top=o+"px",t.style.left=n+"px"}s="trending",u=0,n=null;function _(){if(!r)return;if(!u){r.textContent="";return}var t,e=Math.floor((Date.now()-u)/1e3);e<10?r.textContent="Updated just now":e<60?r.textContent="Updated "+e+"s ago":(t=Math.floor(e/60),r.textContent="Updated "+t+"m ago")}function j(){for(var e,n,t=0;t<v.length;t++)e=v[t],n=e.getAttribute("data-popular-mode")===s,n?e.classList.add("is-active"):e.classList.remove("is-active"),e.setAttribute("aria-selected",n?"true":"false")}function E(){var e="/api/top?limit=25&mode="+encodeURIComponent(s);return s==="trending"&&(e+="&days=7"),e}function w(){h("Loadingâ€¦"),fetch(E(),{cache:"no-store"}).then(function(e){return e.json()}).then(function(e){if(!e||!e.ok||!Array.isArray(e.top))throw new Error("bad");if(c.innerHTML="",e.top.length===0){c.innerHTML='<li class="popular__empty">No popular games yet â€” start clicking game cards and they will appear here.</li>',h("");return}for(var t,o,i,a,r,d,n=0,l=0;l<e.top.length;l++){if(d=e.top[l]||{},t=String(d.id||"").trim(),!t)continue;if(t==="test-game"||t==="test-live"||t.indexOf("test-")===0)continue;if(i=p[t]||g[t.replace(/-/g,"")]||null,i||(i={title:C(t),url:"/all/#"+encodeURIComponent(t)}),r=document.createElement("li"),r.className="popular__item",a=document.createElement("span"),a.className="popular__rank",a.textContent=String(n+1),s==="all"&&(n===0?a.classList.add("popular__rank--gold"):n===1?a.classList.add("popular__rank--silver"):n===2&&a.classList.add("popular__rank--bronze")),o=document.createElement("a"),o.className="popular__link",s==="trending"&&n===0?o.textContent="ðŸ”¥ "+i.title:o.textContent=i.title,o.href=i.url,i.url==="#"&&(o.addEventListener("click",function(e){e.preventDefault()}),o.setAttribute("aria-disabled","true")),r.appendChild(a),r.appendChild(o),c.appendChild(r),n++,n>=10)break}n===0&&(c.innerHTML='<li class="popular__empty">No popular games yet â€” start clicking game cards and they will appear here.</li>'),h(""),loaded=!0,u=Date.now(),_()}).catch(function(){h("Couldn't load popular games right now.")})}d=null;function k(e){d=e||a[0],t.hidden=!1,y(d),j(),w(),n&&clearInterval(n),n=setInterval(_,5e3),a.forEach(function(e){e.setAttribute("aria-expanded","true")})}function f(){t.hidden=!0,n&&(clearInterval(n),n=null),a.forEach(function(e){e.setAttribute("aria-expanded","false")})}function A(e){t.hidden?k(e):f()}a.forEach(function(e){e.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),A(e)})}),v.forEach(function(e){e.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),s=e.getAttribute("data-popular-mode")||"trending",j(),w()})}),x&&x.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),f()}),window.addEventListener("resize",function(){if(t.hidden)return;y(d||a[0])}),document.addEventListener("click",function(e){if(t.hidden)return;var n=e.target;if(!n)return;if(n.closest&&(n.closest("#popularPopover")||n.closest("[data-popular-toggle]")))return;f()}),document.addEventListener("keydown",function(e){e.key==="Escape"&&!t.hidden&&f()})}document.addEventListener("DOMContentLoaded",function(){s(),o(),i(),a(),r(),c()})})()